parameters:
- name: version
  type: version
  default: 0.22.3

extends: [setuptools_package]

dependencies:
  build: [openssl, swig]

sources:
- url: https://pypi.python.org/packages/source/M/M2Crypto/M2Crypto-{{version}}.tar.gz
  key:
    when version == 0.22.3: tar.gz:mby37sax3fdsh2nulcqbbvlfgziqj6ck

build_stages:

- name: install
  after: setup_dirs
  handler: bash
  bash: |
    mkdir -p $ARTIFACT/lib/python2.7/site-packages
    export PYTHONPATH=$PYTHONPATH:$ARTIFACT/lib/python2.7/site-packages
    # build
    $PYTHON setup.py build build_ext --openssl=${OPENSSL_DIR}
    # install
    $PYTHON setup.py install --prefix=${ARTIFACT}
