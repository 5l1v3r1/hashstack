parameters:
- name: version
  type: version
  default: 2.4

extends: [autotools_package]

dependencies:
  build: [libunwind, pkg-config]
  run: [libunwind, pkg-config]

sources:
- url: https://googledrive.com/host/0B6NtGsLhIcf7MWxMMF9JdTN3UVk/gperftools-{{version}}.tar.gz
  key:
    when version == 2.4: tar.gz:tavdoitowqxua4koe24ao2av2xvgo6sc

build_stages:
- when: compiler == 'gcc'
  name: optimization_flags
  after: prologue
  before: configure
  handler: bash
  bash: |
    export CXXFLAGS="-fPIC -O3 -march=native -ffast-math -funroll-loops"

when_build_dependency:
- prepend_path: PKG_CONFIG_PATH
  value: '${ARTIFACT}/lib/pkgconfig'
