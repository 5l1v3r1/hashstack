parameters:
- name: version
  type: version
  default: 2.0.11

- name: relocatable
  type: bool
  default: false

extends: [autotools_package]

dependencies:
  # FIXME: add optional dependencies with a '+'
  build: [gmp, libunistring, pkg-config, libffi, readline, gc, libtool] #, {{build_with}}]
  run: [libtool]

sources:
- url: http://ftp.heanet.ie/mirrors/gnu/guile/guile-{{version}}.tar.gz
  key:
    when version == 2.0.11: tar.gz:4z4gze2di35c4ohenwgydjrcxmobnujq

build_stages:
- name: configure
  extra: ['--disable-dependency-tracking']

# On OSX you may need to have gcc installed from homebrew or otherwise
# Also do something like this - https://gist.githubusercontent.com/alghanmi/8853646/raw/gcc-default-fix.sh
- name: configure
  when: platform == 'Darwin'
  extra: ['--disable-dependency-tracking', '--build=x86_64-apple-darwin10']

when_build_dependency:
- prepend_path: PKG_CONFIG_PATH
  value: '${ARTIFACT}/lib/pkgconfig'

- prepend_path: PATH
  value: '${ARTIFACT}/bin'
