extends: [distutils_package]

dependencies:
  build: [zlib, szip, hdf5, mpi4py, mpi, numpy, cython]
  run: [numpy]

sources:
- key: tar.gz:ir7flvmjhsriluiylkjyksfbf47x2sxu
  url: https://pypi.python.org/packages/source/h/h5py/h5py-2.3.1.tar.gz

build_stages:
- name: install
  after: setup_dirs
  handler: bash
  bash: |
    export CC=${MPICC}
    export CXX=${MPICXX}
    export LDSHARED=${MPICC}
    export LDFLAGS='-shared'
    ${PYTHON} setup.py build_ext --mpi --hdf5=${HDF5_ROOT} --hdf5-version=1.8.13 -L${HDF5_DIR}'/lib' -L${ZLIB_DIR}'/lib' -L${SZIP_DIR}'/lib' --libraries='hdf5,hdf5_hl,szip,z' install --prefix=${ARTIFACT}
