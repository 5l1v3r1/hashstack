paramters:
- name: version
  type: version
  default: 1.14

# /bin/iconv contains hard-coded path
- name: relocatable
  type: bool
  default: false

extends: [autotools_package]

sources:
- url: http://ftp.gnu.org/pub/gnu/libiconv/libiconv-{{version}}.tar.gz
  key:
    when version == 1.14: tar.gz:okze33ix22drspbtm3ioxz6n4htlddyn

build_stages:
  - when: platform == 'linux'
    name: patch
    before: configure
    files: [modern-glibc-workaround.patch]
    handler: bash
    bash: |
      patch -up1 < _hashdist/modern-glibc-workaround.patch

when_build_dependency:
- prepend_path: PKG_CONFIG_PATH
  value: '${ARTIFACT}/lib/pkgconfig'
- prepend_path: PATH
  value: '${ARTIFACT}/bin'
