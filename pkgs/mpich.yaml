parameters:
- name: version
  type: version
  default: 3.0.3

# bin/mpicc contains hard-coded path
- name: relocatable
  type: bool
  default: false

extends: [autotools_package]

dependencies:
  build: [libxml2, pkg-config]

build_stages:
  - name: configure
    mode: update
    extra: ['--enable-shared']

  - when: not fortran
    name: configure
    mode: update
    extra: ['--disable-f77', '--disable-fc']

sources:
  - url: http://www.mpich.org/static/tarballs/{{version}}/mpich-{{version}}.tar.gz
    key:
      when version == 3.0.3: tar.gz:jj5yo7oe3e45wwngkuqqn35bud5kdfkr

when_build_dependency:
  - {set: 'MPICC', value: "${ARTIFACT}/bin/mpicc"}
  - {set: 'MPICXX', value: "${ARTIFACT}/bin/mpic++"}
  - {set: 'MPIF77', value: "${ARTIFACT}/bin/mpif77"}
  - {set: 'MPIF90', value: "${ARTIFACT}/bin/mpif90"}
  - {set: 'MPIEXEC', value: "${ARTIFACT}/bin/mpiexec"}

  - prepend_path: PATH
    value: ${ARTIFACT}/bin
  - prepend_path: PKG_CONFIG_PATH
    value: ${ARTIFACT}/lib/pkgconfig
