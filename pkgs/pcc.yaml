parameters:
- name: version
  type: version
  default: 1.0.0

- name: relocatable
  type: bool
  default: false

extends: [autotools_package]

dependencies:
  build: [bison, flex, pcc-libs]

sources:
- key:
    when version == 1.0.0: tar.gz:labnxosg23vd7g5nvjk3sbckaqllwqia
  url: http://pcc.ludd.ltu.se/ftp/pub/pcc-releases/pcc-{{version}}.tgz

build_stages:
- name: configure
  after: prologue
  mode: replace
  when: platform == 'linux'
  handler: bash
  bash: |
    export CPPFLAGS='-I${PCC_LIBS_DIR}/include}'
    export LDFLAGS='-L${PCC_LIBS_DIR}/lib}'
    ./configure --prefix=${ARTIFACT}

when_build_dependency:
- prepend_path: PATH
  value: '${ARTIFACT}/bin'
