parameters:
- name: version
  type: version
  default: 3.8

#include/Makefile.export.zoltan.macros
- name: relocatable
  type: bool
  default: false

extends: [autotools_package]

dependencies:
  # FIXME: add optional dependencies using '+'
  build: [mpi] #, {{build_with}}]

sources:
- url: http://www.cs.sandia.gov/~kddevin/Zoltan_Distributions/zoltan_distrib_v{{version}}.tar.gz
  key:
    when version == 3.8: tar.gz:lpoumvepxhdtwis3xtz5ebwfldbrrszj

build_stages:

  - name: setup_builddir
    after: prologue
    handler: bash
    bash: |
      mkdir -p _build
      cd _build

  - name: setEnv
    after: setup_builddir
    handler: bash
    bash: |
      export MPI_DIR=$(dirname $(dirname $MPICC) )
      export LD_LIBRARY_PATH=${MPI_DIR}/lib

  - name: configure
    after: setEnv
    configure_path: ".."
    extra: ['--with-cflags=-fPIC', '--with-cxxflags=-fPIC']
